
Пререквизиты
------------  
Прежде чем читать данный документ,  
ознакомьтесь с вводным материалом:  

1) Что такое "[версия][VER]" ?  
2) Концепция "[Семантического Версионирования][SV]"  
3) [Правила версионирования][WV] принятые в workspace.  

[VER]: version/010-version-format.md     "общие сведения"  
[SV]:  version/020-version-semantic.md   "семантическое версионирование"  
[WV]:  version/030-version-workspace.md  "правила версионирования принятые в workspace"  

Как оформлять коммиты
=====================

Главное что нужно понять:  
  - Не нужно писать в коммитах длинные  
    и подробные сообщения о внесенных изменениях.  
  - Не нужно описывать в коммитах детали решаемых задач.  
  - Не нужно даже вкратце описывать суть коммита.  

В комментариях к коммитам мы отражаем лишь тип изменения.  
Для этого используем следующие ключевые слова:  
   - `add` элемент был добавлен.  
   - `upd` элемент был обновлен.  
   - `del` элемент был удален.  
   - `ren` элемент был переименован.  
   - `mov` элемент был перемещен.  
   - `bug` исправление бага.  

После чего указываем название элемента, и его новую версию.  
Например:  

```
#4-commit)   upd: spy/frame.hpp (002) PRE
#3-commit)   add: spy/stack.hpp (001) PRE
#2-commit)   ren: spy/old.hpp (123) -> spy/new.hpp (001) PRE
#1-commit)   mov: xxx/file.hpp (123) -> yyy/file.hpp (001) PRE
```

Такой формат подачи информации идеально подходит для того,  
что бы связывать текущие коммиты с поставленной задачей,  
и с историей развития проекта.  

Если у кого-то возникнет желание разобраться в сути изменений,  
то он без труда свяжет коммиты пулл-реквеста с задачей,  
после чего уже легко сможет понять почему  
и что изменялось в файлах.  

А вот писать длинные и подробные комментарии не имеет смысла.  
Их все равно никто не будет читать.  

Работа в бранче
---------------
Работа над задачей всегда должна осуществляться в отдельном бранче.  
Причем, делать бранч можно только от релизного коммита.  
`Релизный коммит` - это коммит с офф. версией.  
Имеет комментарий `version 1.2.3`  

При этом, в отдельном бранче можно делать какие угодно коммиты,  
вообще не придерживаясь никаких правил.  
Однако, прежде чем создать пулл-реквест,  
нужно привести коммиты в порядок.  

[SM]:  https://www.syntevo.com/smartgit/download  "софт для работы с git"  

1. Для формирования красивых и правильных коммитов,  
   можно использовать удобный инструмент: [samartgit][SM]  
   smartgit - это GUI, с помощью которого удобно и наглядно можно:  
   - перемещать коммиты  
   - расщиплять коммиты  
   - модифицировать коммиты  
   - менять комментарий коммита  

2. В одном коммите должны быть однородные файлы  
   - относятся к одному и тому же каталогу  
   - являются частями одного элемента  

3. Если в коммит попали разношерстные файлы,  
   то такой коммит нужно предварительно расщипить,  
   разделив его на несколько правильных коммитов,  
   с однородными файлами.  
   (это легко делается при помощи smartgit)  

4. Коммиты с однаковым комментарием нужно объединить (засквошить)  

5. Коммиты должны быть расставлены в такой последовательности,  
   что бы, по возможности,  
   хронология изменений не ломала компиляцию.  
   Для этого коммиты можно переставлять местами.  

6. Цепочку коммитов желательно выполнять в последовательности:  
   - первый коммит задачи начинается с фиксации файла самой задачи:  
     - `add: docs/task`  
   - изменение связанные с функциональностью элемента.  
   - изменение связанные с тестированием элемента.  
   - обновлением документации.  
     - `upd: docs/code (Версия) PRE`  
   - обновлением истории.  
     - `upd: docs/history (Версия) PRE`  
   - фиксирующим коммитом.  
     - `fix имяБранча`  

7. Фиксирующий коммит имеет комментарий вида: `fix имяБранча`  
   Это - опциональный коммит.  
   Некоторыми таск-треккеры используют его для того,  
   что бы можно было в автоматическом режиме определить,  
   к какой конкретно задаче относится тот или иной пулл-реквест.  
   Например, такую автоматику использует `github`.  
   Соответственно, если ваш таск-треккер не поддерживает данную фичу,  
   тогда делать такой заключительный коммит не обязательно.  

8. Последний коммит должен быть успешно компилируемым.  

workflow
--------
1. Разработчик создаёт бранч, в имени которого фигурирует номер задачи.  
   - напрмер: `#47_mygtest`  
2. Бранч можно сделать только и только от релизного коммита.  
   - релизный коммит имеет формат:  
     - `version X.Y.Z`  
3. В отдельном бранче выполняется вся задача.  
   - измененые элементы получают новую предварительную версию.  
4. Затем создаётся пул-реквест для вливания задачи в мастер.
   - имя пулл-реквеста: `fix имяБранча`  
5. После одобрения пулл-реквеста, ветка задачи успешно вливается в мастер.  
6. Теперь нужно заменить `PRE-версии` на актуальные.  
   - Если `PRE` элементов много, тогда создаём отдельную задачу,  
     в рамках которой будем актуализировать версии.  
     При этом сам код менять запрещено.  
     Разрешается только указывать правильную версию,  
     и стирать постфикс `PRE`  
   - Затем опять таки выполняем пулл-реквест.  
     И получаем уже итоговые, актуальные версии.  
7. Прямо в мастере создаём релизный коммит.  
   - В этом коммите разрешается только актуализровать `PRE`:  
     - обновить историю.  
     - обновить документауию.  
     - обновить детали.  
   - Коментарий к коммиту должен быть в формате:  
     - `version X.Y.Z`  

------------------------------------------------------------

Иногда могут быть ситуации,
когда пулл-реквест не изменяет версию проекта.  
Например:  
По задаче нужно было доработать документацию.  
Изменения в документации не изменяет версию проекта.  

В таких случаях:  
  - по стандартной схеме создаём бранч,  
  - затем вливаем пулл-реквест,  
  - и завершаем работу релизным коммитом.  

Но поскольку версия проекта не изменилась,  
то и комментарий в таком релизном коммите  
тоже не должен измениться.  

------------------------------------------------------------

Иногда бывают ситуации, 
когда в мастер уже был влит пулл-реквест.  
И тут выясняется, что чего-то не хватает,  
или что-то было неправильно.  

В этом случае используются два варианта:  

1. По стандартной схеме создаём релизный коммит,  
   и далее, по стандартной же схеме создаём задачу на доработку.  
   Задачу так же исполняем по стандартной схеме - в отдельном бранче,  
   с последующим вливанием пулл-реквеста.  

2. Не создаём релизного коммита,  
   а сразу делаем бранч прямо от коммита с пулл-реквестом.  
   В остальном всё тоже самое:  
   - Cоздаём задачу на доработку,  
   - Исполняем задачу в отдельном бранче.  
   - Затем вливаем новый пулл-реквест.  

------------------------------------------------------------

Если версия продукта больше 1,  
то ни в коем случае не сквошим коммиты в мастере!  

Если версия продукта меньше 1,  
тогда допускается сквошить релизный коммит,  
при условии, что изменения не изменяют версию продукта.  



   
